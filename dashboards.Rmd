---
title: "Best practice for publishing dashboards"
---

```{r include=FALSE}
require(knitr)
```

<p class="text-muted">Guidance for publishing Official statistics dashboards</p>

---

# When to use a dashboard

---

The primary route for publishing official statistics is via [Explore Education Statistics](https://explore-education-statistics.service.gov.uk/), however there may be times where you want to compliment official statistics with a dashboard. This may be to do a deeper piece of analysis for a specific user group, or to make use of functionality that isn’t available within the platform.

All dashboards should have a clear use case and reasoning for why they are required. They also need to meet the [latest accessibility regulations](https://www.gov.uk/service-manual/helping-people-to-use-your-service/understanding-wcag).

When published, dashboards can be directed to from existing EES releases [add instructions for where they should go].

---

# Things to consider

---

A little blurb introducing the GDS Service standards and how dashboards should be treated as a digital service. Also how this then informs the below.

---

## User needs

---

Some text will go here.

---

## Accessibility

---

WCAG, and why accessibility is important

Link to sections lower down on testing accessibility in shiny apps.

---

## Governance

---

Why governance is important.

What governance is in place for all dashboards.

What good governance for a dashboard looks like.

---

## Tools / software 

<!-- Not sure on the title of this section yet -->

---

The main dashboard options available to us are - 

* R Shiny
* Python Dash (or other Python-based alternatives)
* PowerBI

We recommend using R Shiny where possible as it’s Open Source, gives more flexibility in formatting, and is most widely used with transferable knowledge. 

This guide will focus on R Shiny as this is the recommended route and has an established process to follow and aligns with the long term department strategy.

---

## Iterative development

---

Why taking the an agile and iterative approach to development is important.

How to approach this.

---

## Testing

---

Why testing is important

How to set it up (link to sections lower down rather than put everything here)

---

## Analytics

---

Why analytics are important

How to set them up

---

# R Shiny 

---


---

## How to start

---

When using R Shiny you can choose to create an app from scratch or by using a specific dashboard package such as [shinydashboard](https://rstudio.github.io/shinydashboard/). 

A straight shiny app gives full flexibility, but may take more effort to get your dashboard to look how you want it to. The shinydashboard package gives a simplified template for Shiny, it has less flexibility but gives quick and simple structures to help create your dashboard. 

There are a lot of resources already available to support you when working with 

[List them]

Our template shiny app [LINK] repo should be used a starting point for all public facing dashboards as it gives the right set up for publishing and provides template code for common parts.

---

## Standards to follow

---

<!-- ## Does it make more sense to move this to after publishing? Or within the external apps bit? -->

<!-- Think it makes sense here! We'd want them to consider the standards while they're building rather than after so it flows nicely as is  -->

---

### Accessibility

---

All dashboards need to meet the latest accessibility regulations [include a link].

Key things to be aware of are:

[List main requirements for accessibility regs]

There are existing tools/packages that can help ensure your dashboards are accessible - 

[Pull from the resources Cam found: https://trello.com/c/PStG9EkN/1019-r-shiny-accessibility]

Actively consider what users need from your dashboard - can they get that from the alt text etc. that you have provided? 
(https://www.w3.org/WAI/tutorials/images/decision-tree/)
Use the Edge narrator tool to test out how your dashboard works in reality with a screen reader.

---

### Styling

---

We don’t have an agreed style for Shiny apps / dashboards yet so need to agree one. 

Have a look at how transferable the https://github.com/moj-analytical-services/shinyGovstyle stuff is. 

Teams should pick from the [gov.uk design system colours](https://design-system.service.gov.uk/styles/colour/) when creating dashboards. Our template style sheet [LINK TO CODE IN REPO] makes use of these colours, but can be extended if needed to suit your needs. Consider which colours have sufficient contrast to be placed next to each other using the [colour contrast checker](https://contrast-checker.glitch.me/)
<!-- Palette stuff to put in here too when complete -->

Charts using ggplot2 and plotly can take custom palettes using the `scale_fill_manual()` function, e.g. below:


```
# Create colour palette using gov.uk standard options

dfe_colours <- c(
  "#1d70b8", #`blue`
  "#f47738",#`orange`       
  "#28a197",#`turquoise`   
  "#d53880",#`pink`       
  "#6f72af"#`light-purple` 
  )
  
# Create chart using palette

ggplot(aes(y=value, x="", 
                 fill = factor(rating),
                 text = paste(rating, ": ", value, "%"))) + 
      geom_bar(stat="identity", position = position_fill(reverse = TRUE))+
      scale_fill_manual(values = dfe_colours)

```

You can use in-line CSS to make these style changes, or make edits to the style sheet. Editing the style sheet is a neater solution if you want to apply changes across your app, and keeps your UI code clean. You can find out how styles are configured by running your app, right clicking and selecting "Inspect" to view the element you wish to change. In these lines you can change fonts, font colours and background colours, for example.

[DEMO HERE - GIF?]
---

### Testing

---

To ensure that they are reliable, apps/dashboards should have an appropriate amount of automated tests before they can be published.

https://dfe-analytical-services.github.io/good-code-practice/testing.html#testing-shiny-apps 

Also see our guidance on testing R code on the [learning resources page](l+d.html#R).

---

### Connecting to databases

---

We don't yet have a database server set up that can be accessed by public facing dashboards, though we are working to put this in place. In the meantime there a few alternative options for storing data that the dashboard can run off.

- Recommended - Store the data within the repo (e.g. CSV files in a /data folder)

- Use Google sheets

- Use dropbox

If you are running an internal-only app then you can connect to our internal SQL servers, information on how to do this is in the R Shiny Developers teams area.

---

## How to publish a dashboard 

---

How you choose to publish your app will depend on the type of access you require for it.  

---

### Internal only apps

---

It's possible to publish dashboards that are only accessible to those on DfE kit, to do this you will need to publish via the departments RSConnect servers.

You will need: 

* A finished app, in line with the guidance on this page
* The code to be in a Git repository in the dfe-gov-uk Azure DevOps space

To publish the app, you'll need to set up a pipeline in Azure DevOps, guidance for how to do this can be found in the [R Shiny Developers teams area](https://teams.microsoft.com/l/team/19%3a311ec2e4d46b4dd38f0d61f05fb93383%40thread.skype/conversations?groupId=b95c605d-8fbc-4e4d-9a76-2f7d1c55e70a&tenantId=fad277c9-c60a-4da1-b5f3-b3b8b34a82f9).

Access to applications on RSConnect are locked down by default, once the pipeline is set up and you've deployed the app you' can then'll need to request for it's access to be opened up by using an RSConnect request on [ServiceNow](https://dfe.service-now.com/serviceportal?id=sc_cat_item&sys_id=1e3c3cb9db80ab003b929334ca9619df&sysparm_category=09e18be6db2f8340865049ee3b96190f).

---

### External apps

---

The majority of dashboards made to support and augment our Official Statistics public facing shiny apps you should publish via shinyapps.io. The statistics development team manage a subscription for this and can help you get set up. 

You will need:

* A finished app, in line with standards [standards TBC]
* Code in a github repo
* Github Actions set up 

**Github Actions:**

We use Github Actions to deploy the latest code whenever a push to your master branch occurs - this ensure the published version of your app stays up to date. 

If you’ve started from our empty project template [we should provide this] this will mostly be set up for you, but if not you’ll need to add the following folder to your repo [LINK] 


You should also use Github Actions to run the automated tests for your app, which we recommend are done on at least every pull request. An example yaml file for running the tests is included in the template repo [LINK]. 


---

## Learning resources

---

For learning more about shiny, the best place to start is --


<!-- This is a nice intro blog to R shiny - covers the basics of how the files interact https://www.r-bloggers.com/2021/03/a-gentle-introduction-to-r-shiny/ -->

<!-- Also can link to a template repo referenced earlier? Not just style sheets/github actions stuff but also a basic app with plots, boxes, text etc. that could be adapted -->

For more advanced shiny knowledge go here - 


Below are a bunch of tips and tricks that we've found useful when building R Shiny applications. There are also some of these already stored on teams in the [R Shiny Developers channel](https://teams.microsoft.com/l/entity/com.microsoft.teamspace.tab.wiki/tab::d9f50997-7180-407d-baf9-47f9ec9d54a3?context=%7B%22subEntityId%22%3A%22%7B%5C%22pageId%5C%22%3A21%2C%5C%22origin%5C%22%3A2%7D%22%2C%22channelId%22%3A%2219%3A311ec2e4d46b4dd38f0d61f05fb93383%40thread.skype%22%7D&tenantId=fad277c9-c60a-4da1-b5f3-b3b8b34a82f9){target="_blank" rel="noopener noreferrer"}.

---

### Creating PATs

---

PATs or Personal access tokens, are a preferred way to authenticate into repositories through code. [Creating a PAT in GitHub](https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/creating-a-personal-access-token#creating-a-token){target="_blank" rel="noopener noreferrer"} is relatively intuitive. In Azure DevOps, you can do this by following [Microsoft's documentation on creating a PAT in Azure DevOps](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops&tabs=preview-page#create-personal-access-tokens-to-authenticate-access){target="_blank" rel="noopener noreferrer"}.

This section feels like it should be moved to the Git page

---

I'm not sure where these last two bits should live? 

What about profiling R code?
<!-- Have a small section on this in peer review - could link to it here too as something to consider? https://rsconnect/rsc/stats-production-guidance/rap.html#Review_of_code_within_team -->

StyleR
<!-- We have something on this in our RAP guidance https://rsconnect/rsc/stats-production-guidance/rap.html#clean-final-code so could link to that and provide more detail here about including style stuff in tests too? -->

Automated testing
<!-- Could add to the testing bit above? We have some bits in our RAP guidance https://rsconnect/rsc/stats-production-guidance/rap.html#Automated_quality_assurance but would be good to cover test that vs shiny test and point to template code repo that uses both -->

CI

---

### Storing secure variables

---

#### Azure DevOps

---

In Azure DevOps you can securely store variables that are then used by your pipelines by making use of variable groups. 

First create a variable group by navigating to `Pipelines > Library`. Enter any variables you want to store here and make sure to change the variable type to secret if appropriate (i.e. login credentials or PATs).

`r knitr::include_graphics("images/createVariableGroup.png")`

Then, in the pipeline you want to use the variables in, go to `Variables > Variable groups` and link the variable group as shown below. You can then call upon the variables as needed in your pipeline.

`r knitr::include_graphics("images/linkVariableGroup.png")`

---

#### GitHub

---

---

### Mirroring a repository

---

There may be times when you have a repository in one place, such as Azure DevOps, but want to mirror the code and any changes to it in another place, such as GitHub. This can be for many different reasons, though commonly for us it will be to open up our code across government. Azure DevOps doesn't provide us with easily publicly visible code repositories, however GitHub does.

To mirror a code repository from Azure DevOps, use the [mirror git repository extension](https://github.com/swellaby/vsts-mirror-git-repository){target="_blank" rel="noopener noreferrer"} (already installed on dfe-gov-uk instance), make use of the PAT and secure variables sections above and then add a job to your pipeline and enter your parameters in the fields as per the example below:

`r knitr::include_graphics("images/mirroringGit.png")`

Again this feels like it should be moved to the Git page

---
